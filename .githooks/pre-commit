#!/bin/sh
# Run project linters before committing.
# Install once per clone: git config core.hooksPath .githooks

set -e

# Allow skipping when explicitly requested
[ -n "$SKIP_LINT" ] && exit 0

ROOT="$(git rev-parse --show-toplevel 2>/dev/null || pwd)"
cd "$ROOT"

if [ ! -f "composer.json" ]; then
  exit 0
fi

if [ ! -x "vendor/bin/phpcs" ] || [ ! -x "vendor/bin/psalm" ] || [ ! -x "vendor/bin/phpstan" ]; then
  echo "Composer dependencies missing. Run: composer install" >&2
  exit 1
fi

echo "Running composer lint ..."
composer lint

