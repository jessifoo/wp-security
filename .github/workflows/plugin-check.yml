name: WordPress Plugin Check

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

permissions:
  contents: read

jobs:
  plugin-check:
      runs-on: ubuntu-latest
      timeout-minutes: 15
      steps:
      - uses: actions/checkout@v3
            - name: Setup Composer Cache
              uses: actions/cache@v3
              with:
                path: ~/.composer/cache
                key: composer-${{ hashFiles('**/composer.lock') }}
                restore-keys: composer-
            - name: Install PHP dependencies
              run: composer install --no-interaction --no-progress --prefer-dist --no-dev
        run: composer install --no-interaction --no-progress --prefer-dist --no-dev
      - name: WordPress Plugin Check
        uses: WordPress/plugin-check-action@v1.1.0
        with:
          build-dir: ./
          checks: all
          categories: security,compatibility,performance
          severity: high
          error-severity: error
          warning-severity: warning
          strict: true
